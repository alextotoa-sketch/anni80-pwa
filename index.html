<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Io negli anni â€™80 câ€™ero</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}

body{
  background:#0f0f0f;
  color:#fff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  text-align:center;
  padding:16px;
  border-bottom:2px solid #00e5ff;
}
header h1{color:#00e5ff}
header p{color:#aaa;font-size:.9rem}

/* MAIN */
main{
  flex:1;
  padding:12px;
  padding-bottom:180px;
}

/* CATEGORIE */
.categories{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-bottom:12px;
}
.category{
  border:2px solid #00e5ff;
  border-radius:14px;
  padding:12px;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
}
.category.active{
  background:#00e5ff;
  color:#000;
}

/* CONTENUTO */
#content{
  border:2px solid #00e5ff;
  border-radius:14px;
  padding:14px;
  min-height:200px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.card{
  border:2px solid #00e5ff;
  border-radius:14px;
  padding:14px;
  background:#1c1c1c;
  cursor:pointer;
  text-align:center;
}
.card:hover{background:#00e5ff;color:#000}
a.card{color:inherit;text-decoration:none}

/* ===== VU METER ===== */
#vumeter-wrapper{
  display:flex;
  justify-content:center;
  margin-bottom:6px;
}

#vumeter{
  display:flex;
  gap:2px;
  align-items:flex-end;
  height:50px;
}

.vu{
  width:6px;
  height:6px;
  background:#222;
  border-radius:2px;
  transition:height .12s;
}
.vu.g{background:#00ff66}
.vu.y{background:#ffee00}
.vu.r{background:#ff0033}

/* PLAYER */
#player{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#1c1c1c;
  border-top:2px solid #00e5ff;
  padding:10px;
  text-align:center;
  z-index:500;
}
#now{color:#00e5ff;font-weight:bold;margin-bottom:6px}
audio{width:95%}

/* CHAT */
#chat{
  position:fixed;
  inset:0;
  background:#111;
  display:none;
  flex-direction:column;
  z-index:2000;
}

#chatHeader{
  padding:14px;
  background:#161616;
  border-bottom:1px solid #222;
  display:flex;
  justify-content:space-between;
}
#chatHeader strong{color:#00e5ff}

#chatMessages{
  flex:1;
  overflow-y:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.message{
  background:#1f1f1f;
  border-radius:14px;
  padding:10px 12px;
  max-width:85%;
  cursor:pointer;
}
.message strong{
  color:#00e5ff;
  font-size:.85rem;
  display:block;
}
.message span{font-size:.95rem}

/* REPLY BOX */
#replyBox{
  display:none;
  background:#222;
  padding:8px 12px;
  font-size:.85rem;
  border-left:4px solid #00e5ff;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#replyLabel{color:#fff}
#replyNick{color:#00e5ff}

/* CHAT FORM */
#chatForm{
  display:flex;
  padding:10px;
  gap:8px;
  background:#161616;
  border-top:1px solid #222;
}

#chatInput{
  flex:1;
  padding:12px 14px;
  border-radius:20px;
  border:none;
  background:#2a2a2a;
  color:#fff;
  font-size:16px;
}

#chatForm button{
  padding:12px 18px;
  border-radius:20px;
  border:none;
  background:#00e5ff;
  font-weight:bold;
}

/* CHAT TOGGLE */
#chatToggle{
  position:fixed;
  bottom:190px;
  right:14px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:#00e5ff;
  border:none;
  font-size:26px;
  z-index:1100;
}

/* MOBILE */
@media(max-width:900px){
  .categories{grid-template-columns:1fr 1fr}
  #vumeter{height:40px}
}
</style>
</head>

<body>

<header>
  <h1>Io negli anni â€™80 câ€™ero</h1>
  <p>Musica Â· Radio Â· Giochi Â· Chat</p>
</header>

<main>
  <div class="categories" id="categories"></div>
  <div id="content">Seleziona una sezione.</div>
</main>

<div id="player">
  <div id="vumeter-wrapper">
    <div id="vumeter"></div>
  </div>
  <div id="now">Nessuna radio in riproduzione</div>
  <audio id="audio" controls></audio>
</div>

<button id="chatToggle">ðŸ’¬</button>

<div id="chat">
  <div id="chatHeader">
    <strong>ðŸ’¬ Chat anni â€™80</strong>
    <button onclick="closeChat()" style="background:none;border:none;color:#00e5ff;font-size:22px">âœ•</button>
  </div>

  <div id="chatMessages"></div>

  <div id="replyBox">
    <span id="replyLabel">Rispondi a <span id="replyNick"></span></span>
    <button onclick="cancelReply()" style="background:none;border:none;color:#00e5ff;font-size:18px">âœ•</button>
  </div>

  <form id="chatForm">
    <input id="chatInput" placeholder="Scrivi un messaggioâ€¦" autocomplete="off">
    <button>Invia</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyB8h3fvyPxq_Tjp2R5RzsgEC7jv6FASeWE",
  authDomain:"anni-80-chat-a1192.firebaseapp.com",
  databaseURL:"https://anni-80-chat-a1192-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"anni-80-chat-a1192"
});
const db = getDatabase(app);
const chatRef = ref(db,"chat");

/* NICK */
let nickname = localStorage.getItem("anni80_nick");
while(!nickname){
  nickname = prompt("Inserisci il tuo nickname anni â€™80:");
  if(nickname) localStorage.setItem("anni80_nick", nickname);
}

const chat=document.getElementById("chat");
const chatForm=document.getElementById("chatForm");
const chatInput=document.getElementById("chatInput");
const chatMessages=document.getElementById("chatMessages");
const replyBox=document.getElementById("replyBox");
const replyNick=document.getElementById("replyNick");

let replyTo=null;

chatForm.addEventListener("submit",e=>{
  e.preventDefault();
  if(chatInput.value.trim()){
    push(chatRef,{
      nick:nickname,
      text:chatInput.value,
      reply:replyTo
    });
    chatInput.value="";
    replyTo=null;
    replyBox.style.display="none";
  }
});

onChildAdded(chatRef,s=>{
  const m=s.val();
  const d=document.createElement("div");
  d.className="message";
  d.innerHTML=`
    ${m.reply?`<div style="font-size:.8rem;opacity:.7;border-left:3px solid #00e5ff;padding-left:6px;margin-bottom:4px">${m.reply}</div>`:""}
    <strong>${m.nick}</strong>
    <span>${m.text}</span>
  `;
  d.onclick=()=>{
    replyTo = m.nick;
    replyNick.textContent = m.nick;
    replyBox.style.display="flex";
    setTimeout(()=>chatInput.focus(),100);
  };
  chatMessages.appendChild(d);
  chatMessages.scrollTop=chatMessages.scrollHeight;
});

window.cancelReply=()=>{
  replyTo=null;
  replyBox.style.display="none";
};

window.closeChat=()=>chat.style.display="none";
document.getElementById("chatToggle").onclick=()=>chat.style.display="flex";

/* RADIO + UI + VU METER invariati */
</script>

</body>
</html>
