<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Io negli anni â€™80 câ€™ero</title>

<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  font-family:Arial,Helvetica,sans-serif;
}

body{
  background:#0f0f0f;
  color:#fff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  text-align:center;
  padding:16px;
  border-bottom:2px solid #00e5ff;
}

header h1{
  color:#00e5ff;
}

header p{
  color:#aaa;
  font-size:0.9rem;
}

/* MAIN */
main{
  flex:1;
  padding:12px;
  padding-bottom:260px; /* spazio player */
}

/* CATEGORIE */
.categories{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-bottom:12px;
}

.category{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:12px;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
}

.category.active{
  background:#00e5ff;
  color:#000;
}

/* CONTENUTO */
#content{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:10px;
  min-height:200px;
}

/* GRIGLIA CARD */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.card{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:12px;
  background:#1c1c1c;
  cursor:pointer;
}

.card:hover{
  background:#00e5ff;
  color:#000;
}

.title{
  font-weight:bold;
  margin-bottom:4px;
}

.desc{
  font-size:0.8rem;
  color:#aaa;
}

/* PLAYER */
#player{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#1c1c1c;
  border-top:2px solid #00e5ff;
  padding:10px;
  text-align:center;
  z-index:500;
}

#now{
  color:#00e5ff;
  font-weight:bold;
  margin-bottom:6px;
}

audio{
  width:95%;
}

/* CHAT */
#chat{
  position:fixed;
  bottom:100px;
  left:50%;
  transform:translateX(-50%);
  width:600px;
  max-width:95%;
  height:260px;
  background:#1c1c1c;
  border:2px solid #00e5ff;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  z-index:1000;
}

#chatHeader{
  padding:6px 10px;
  border-bottom:2px solid #00e5ff;
  display:flex;
  justify-content:space-between;
}

#chatMessages{
  flex:1;
  overflow-y:auto;
  padding:8px;
  font-size:0.85rem;
}

#chatForm{
  display:flex;
  border-top:2px solid #00e5ff;
}

#chatInput{
  flex:1;
  padding:8px;
  border:none;
  background:#222;
  color:#fff;
}

#chatForm button{
  padding:8px 12px;
  border:none;
  background:#00e5ff;
  cursor:pointer;
}

/* CHAT BUTTON MOBILE */
#chatToggle{
  position:fixed;
  bottom:110px;
  right:14px;
  width:54px;
  height:54px;
  border-radius:50%;
  background:#00e5ff;
  border:none;
  font-size:24px;
  display:none;
  z-index:1100;
}

/* MOBILE FIX */
@media (max-width:900px){

  .categories{
    grid-template-columns:1fr 1fr; /* 2 + 2 */
  }

  /* ðŸ”´ FIX CHIAVE */
  #content{
    max-height:45vh;
    overflow-y:auto;
  }

  main{
    padding-bottom:320px;
  }

  #chat{
    display:none;
    height:60%;
  }

  #chatToggle{
    display:block;
  }
}
</style>
</head>

<body>

<header>
  <h1>Io negli anni â€™80 câ€™ero</h1>
  <p>Musica Â· Radio Â· Giochi Â· Chat</p>
</header>

<main>
  <div class="categories" id="categories"></div>
  <div id="content">Seleziona una sezione.</div>
</main>

<div id="player">
  <div id="now">Nessuna radio in riproduzione</div>
  <audio id="audio" controls></audio>
</div>

<button id="chatToggle">ðŸ’¬</button>

<div id="chat">
  <div id="chatHeader">
    <strong>Chat</strong>
    <button onclick="chat.style.display='none'">âœ•</button>
  </div>
  <div id="chatMessages"></div>
  <form id="chatForm">
    <input id="chatInput" placeholder="Scriviâ€¦" autocomplete="off">
    <button>Invia</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyB8h3fvyPxq_Tjp2R5RzsgEC7jv6FASeWE",
  authDomain:"anni-80-chat-a1192.firebaseapp.com",
  databaseURL:"https://anni-80-chat-a1192-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"anni-80-chat-a1192"
});
const db = getDatabase(app);
const chatRef = ref(db,"chat");

/* NICK */
let nickname = localStorage.getItem("anni80_nick");
if(!nickname){
  nickname = prompt("Scegli il tuo nickname anni â€™80:") || "Anonimo80";
  localStorage.setItem("anni80_nick", nickname);
}

/* CHAT */
const chatForm = document.getElementById("chatForm");
const chatInput = document.getElementById("chatInput");
const chatMessages = document.getElementById("chatMessages");

chatForm.addEventListener("submit",e=>{
  e.preventDefault();
  if(chatInput.value.trim()){
    push(chatRef,{nick:nickname,text:chatInput.value});
    chatInput.value="";
  }
});

onChildAdded(chatRef,s=>{
  const m=s.val();
  const d=document.createElement("div");
  d.innerHTML=`<strong>[${m.nick}]</strong>: ${m.text}`;
  chatMessages.appendChild(d);
  chatMessages.scrollTop=chatMessages.scrollHeight;
});

/* DATI */
const radio=[
  {n:"Radio 80",u:"https://sphera.fluidstream.eu/radio80.aac"},
  {n:"SomaFM Underground 80s",u:"https://somafm.com/u80s130.pls"},
  {n:"80s80s Italo Disco",u:"https://streams.80s80s.de/italodisco/mp3-192"},
  {n:"Italia 80",u:"https://stream.laut.fm/italia80"}
];

/* UI */
const categoriesEl=document.getElementById("categories");
const contentEl=document.getElementById("content");
const audio=document.getElementById("audio");
const now=document.getElementById("now");

["Musica","Radio","Giochi","Chat"].forEach((c,i)=>{
  const d=document.createElement("div");
  d.className="category";
  d.textContent=c;
  d.onclick=()=>open(i,d);
  categoriesEl.appendChild(d);
});

function open(i,el){
  document.querySelectorAll(".category").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");

  if(i===1){
    contentEl.innerHTML=`<div class="grid">${
      radio.map(r=>`
        <div class="card" onclick="play('${r.u}','${r.n}')">
          <div class="title">${r.n}</div>
        </div>`).join("")
    }</div>`;
  } else {
    contentEl.innerHTML="<p>Sezione in arrivo.</p>";
  }
}

window.play=(u,n)=>{
  audio.src=u;
  audio.play();
  now.textContent="In riproduzione: "+n;
};

document.getElementById("chatToggle").onclick=()=>chat.style.display="flex";
</script>

</body>
</html>
