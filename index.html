<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Io negli anni '80 c'ero</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00e5ff">
<link rel="apple-touch-icon" href="images/icon-192.png">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#0f0f0f;
  --card:#1c1c1c;
  --accent:#00e5ff;
  --text:#ffffff;
  --muted:#aaaaaa;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;}

body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}
header{padding:20px;text-align:center;border-bottom:2px solid var(--accent);}
header h1{color:var(--accent);font-size:2rem;}
header p{color:var(--muted);margin-top:6px;}
main{flex:1;padding:20px;padding-bottom:170px;}
.categories{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-bottom:20px;}
.category{border:2px solid var(--accent);padding:12px;text-align:center;border-radius:12px;cursor:pointer;font-weight:600;transition:0.2s;}
.category.active,.category:hover{background:var(--accent);color:#000;}
#content{border:2px solid var(--accent);border-radius:14px;padding:16px;min-height:300px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;}
.card{background:var(--card);border:2px solid var(--accent);border-radius:14px;padding:14px;cursor:pointer;transition:0.2s;}
.card:hover{background:var(--accent);color:#000;}
.card .title{font-weight:700;margin-bottom:6px;}
.card .desc{font-size:0.85rem;color:var(--muted);}
#player{position:fixed;bottom:0;left:0;width:100%;background:var(--card);border-top:2px solid var(--accent);padding:10px;text-align:center;}
#now{color:var(--accent);font-weight:700;margin-bottom:6px;}
audio{width:90%;}

/* CHAT */
#chat-category{margin-top:20px;}
#chat-category h2{color: var(--accent);margin-bottom:6px;}
#chat-messages{height:200px;overflow-y:auto;border:2px solid var(--accent);border-radius:12px;padding:10px;background:var(--card);margin-bottom:10px;}
#chat-input{width:70%;padding:8px;border-radius:8px;border:1px solid var(--accent);background:#1c1c1c;color:#fff;}
#chat-send{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer;}
.message-admin{color:#ff5555;cursor:pointer;float:right;font-weight:700;}
</style>
</head>

<body>

<header>
<h1>io negli anni '80 c'ero</h1>
<p>Musica, radio e giochi retr√≤</p>
</header>

<main>
<div class="categories" id="categories"></div>
<div id="content">Seleziona una categoria.</div>
</main>

<div id="player">
<div id="now">Nessuna radio in riproduzione</div>
<audio id="audio" controls></audio>
</div>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "TUO_API_KEY",
  authDomain: "TUO_PROGETTO.firebaseapp.com",
  databaseURL: "https://TUO_PROGETTO.firebaseio.com",
  projectId: "TUO_PROGETTO",
  storageBucket: "TUO_PROGETTO.appspot.com",
  messagingSenderId: "TUO_ID",
  appId: "TUO_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== CATEGORIE ===== */
const categories = [
  { id: "musica", label: "Musica" },
  { id: "radio", label: "Radio" },
  { id: "giochi", label: "Giochi" },
  { id: "chat", label: "Chat" } // nuova categoria
];

const musica = [{ name:"Playlist anni '80", url:"https://youtu.be/6_cAP0aXZXA" }];
const radio = [
{name:"Radio 80", url:"https://sphera.fluidstream.eu/radio80.aac", desc:"Pop e rock anni '80"},
{name:"SomaFM Underground 80s", url:"http://ice1.somafm.com/u80s-128-mp3", desc:"New wave, synth, alternative"},
{name:"80s80s Italo Disco", url:"https://streams.80s80s.de/italodiscomix/mp3-192/streams.80s80s.de/", desc:"Italo disco anni '80"},
{name:"Italia 80", url:"https://stream.laut.fm/italia80", desc:"Musica italiana anni '80"}];
const giochi = [{name:"üéÆ Giochi retr√≤", url:"https://www.retrogames.cc/arcade-games/space-invaders.html", desc:"Arcade anni ‚Äô80 ‚Äì gioca online"}];

const categoriesEl=document.getElementById("categories");
const contentEl=document.getElementById("content");
const audio=document.getElementById("audio");
const now=document.getElementById("now");

/* ===== MENU ===== */
categories.forEach(cat=>{
  const div = document.createElement("div");
  div.className = "category";
  div.textContent = cat.label;
  div.onclick = () => openCategory(cat.id, div);
  categoriesEl.appendChild(div);
});

function resetCategories(){document.querySelectorAll(".category").forEach(c=>c.classList.remove("active"));}

/* ===== SEZIONI ===== */
function openCategory(id, el){
  resetCategories(); el.classList.add("active");

  if(id==="musica"){
    contentEl.innerHTML = `<div class="grid">${musica.map(m=>`
      <div class="card" onclick="window.open('${m.url}','_blank')">
        <div class="title">${m.name}</div>
        <div class="desc">Apri su YouTube</div>
      </div>`).join("")}</div>`;
  }

  if(id==="radio"){
    contentEl.innerHTML = `<div class="grid">${radio.map(r=>`
      <div class="card" onclick="playRadio('${r.url}','${r.name}')">
        <div class="title">${r.name}</div>
        <div class="desc">${r.desc}</div>
      </div>`).join("")}</div>`;
  }

  if(id==="giochi"){
    contentEl.innerHTML = `<div class="grid">${giochi.map(g=>`
      <div class="card" onclick="window.open('${g.url}','_blank')">
        <div class="title">${g.name}</div>
        <div class="desc">${g.desc}</div>
      </div>`).join("")}</div>`;
  }

  if(id==="chat"){
    contentEl.innerHTML = `
      <div id="chat-category">
        <h2>Chat Anni '80</h2>
        <div id="chat-messages"></div>
        <input type="text" id="chat-input" placeholder="Scrivi qui...">
        <button id="chat-send">Invia</button>
      </div>
    `;

    // Inizializza chat
    let nickname = localStorage.getItem("nickname") || "";
    if(!nickname){
      nickname = prompt("Scegli un nickname:", "Guest80") || "Guest80";
      localStorage.setItem("nickname", nickname);
    }
    const adminNickname = "Admin80";
    const isAdmin = nickname === adminNickname;

    const chatMessages = document.getElementById("chat-messages");
    const chatInput = document.getElementById("chat-input");
    const chatSend = document.getElementById("chat-send");

    function addMessage(msg,id){
      const div = document.createElement("div");
      div.textContent = `${msg.nickname}: ${msg.text}`;
      if(isAdmin){
        const del = document.createElement("span");
        del.textContent=" ‚úñ";
        del.className="message-admin";
        del.onclick = () => db.ref("messages/"+id).remove();
        div.appendChild(del);
      }
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    chatSend.onclick = () => {
      const text = chatInput.value.trim();
      if(text.length===0) return;
      if(text.length>200) return alert("Messaggio troppo lungo!");
      db.ref("messages").push({nickname,text,timestamp:Date.now()});
      chatInput.value="";
    }

    db.ref("messages").on("child_added", snapshot => {
      addMessage(snapshot.val(), snapshot.key);
    });
  }
}

/* ===== RADIO PLAYER ===== */
function playRadio(url,name){
  audio.src=url;
  audio.play();
  now.textContent="In riproduzione: "+name;
}

/* ===== SERVICE WORKER ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js")
    .then(()=>console.log("Service Worker registrato ‚úÖ"))
    .catch(err=>console.error("Errore SW:",err));
}
</script>

</body>
</html>
