<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Io negli anni ‚Äô80 c‚Äôero</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}

body{
  background:#0f0f0f;
  color:#fff;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
header{
  text-align:center;
  padding:16px;
  border-bottom:2px solid #00e5ff;
}
header h1{color:#00e5ff}
header p{color:#aaa;font-size:.9rem}

/* MAIN */
main{
  flex:1;
  padding:12px;
  padding-bottom:160px;
}

/* CATEGORIE */
.categories{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-bottom:12px;
}
.category{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:12px;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
}
.category.active{
  background:#00e5ff;
  color:#000;
}

/* CONTENUTO */
#content{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:14px;
  min-height:200px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.card{
  border:2px solid #00e5ff;
  border-radius:12px;
  padding:12px;
  background:#1c1c1c;
  cursor:pointer;
  text-align:center;
}
.card:hover{background:#00e5ff;color:#000}
a.card{color:inherit;text-decoration:none}

/* PLAYER */
#player{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#1c1c1c;
  border-top:2px solid #00e5ff;
  padding:10px;
  text-align:center;
  z-index:500;
}
#now{color:#00e5ff;font-weight:bold;margin-bottom:6px}
audio{width:95%}

/* ===== VU METER ===== */
#vumeter{
  display:flex;
  justify-content:center;
  align-items:flex-end;
  gap:2px;
  margin:10px auto;
  height:40px;
}

.vu{
  width:6px;
  height:10%;
  background:#0f0;
  transition:height .08s;
}
.vu.yellow{background:#ff0}
.vu.red{background:#f00}

/* CHAT */
#chat{
  position:fixed;
  inset:0;
  background:#0f0f0f;
  display:none;
  flex-direction:column;
  z-index:2000;
}

#chatHeader{
  padding:14px;
  border-bottom:2px solid #00e5ff;
  display:flex;
  justify-content:space-between;
  background:#1c1c1c;
}

#chatMessages{
  flex:1;
  overflow-y:auto;
  padding:14px;
}

#chatForm{
  display:flex;
  border-top:2px solid #00e5ff;
  background:#1c1c1c;
}

#chatInput{
  flex:1;
  padding:14px;
  border:none;
  background:#222;
  color:#fff;
  font-size:16px;
}

#chatForm button{
  padding:14px 18px;
  border:none;
  background:#00e5ff;
  font-weight:bold;
}

/* CHAT TOGGLE */
#chatToggle{
  position:fixed;
  bottom:120px;
  right:14px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:#00e5ff;
  border:none;
  font-size:26px;
  z-index:1100;
}

/* MOBILE */
@media(max-width:900px){
  .categories{grid-template-columns:1fr 1fr}
}
</style>
</head>

<body>

<header>
  <h1>Io negli anni ‚Äô80 c‚Äôero</h1>
  <p>Musica ¬∑ Radio ¬∑ Giochi ¬∑ Chat</p>
</header>

<main>
  <div class="categories" id="categories"></div>
  <div id="content">Seleziona una sezione.</div>
</main>

<div id="player">
  <div id="now">Nessuna radio in riproduzione</div>
  <div id="vumeter"></div>
  <audio id="audio" controls></audio>
</div>

<button id="chatToggle">üí¨</button>

<!-- CHAT -->
<div id="chat">
  <div id="chatHeader">
    <strong>üí¨ Chat anni ‚Äô80</strong>
    <button onclick="chat.style.display='none'"
      style="background:none;border:none;color:#00e5ff;font-size:22px">‚úï</button>
  </div>
  <div id="chatMessages"></div>
  <form id="chatForm">
    <input id="chatInput" placeholder="Scrivi‚Ä¶">
    <button>Invia</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* FIREBASE */
const app=initializeApp({
  apiKey:"AIzaSyB8h3fvyPxq_Tjp2R5RzsgEC7jv6FASeWE",
  authDomain:"anni-80-chat-a1192.firebaseapp.com",
  databaseURL:"https://anni-80-chat-a1192-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"anni-80-chat-a1192"
});
const db=getDatabase(app);
const chatRef=ref(db,"chat");

/* ===== NICK OBBLIGATORIO (ANCHE SE GI√Ä ANONIMO) ===== */
let nickname = localStorage.getItem("anni80_nick");

const invalidNicks = ["", "anonimo", "anonimo80", null];

while(
  !nickname ||
  invalidNicks.includes(nickname.toLowerCase().trim())
){
  nickname = prompt(
    "Inserisci un NICKNAME anni ‚Äô80 OBBLIGATORIO:\n\n" +
    "Serve per partecipare alla chat."
  );
}

nickname = nickname.trim();
localStorage.setItem("anni80_nick", nickname);

/* CHAT */
const chat=document.getElementById("chat");
chatToggle.onclick=()=>chat.style.display="flex";

chatForm.addEventListener("submit",e=>{
  e.preventDefault();
  if(chatInput.value.trim()){
    push(chatRef,{nick:nickname,text:chatInput.value});
    chatInput.value="";
  }
});

onChildAdded(chatRef,s=>{
  const m=s.val();
  chatMessages.innerHTML+=`<div><strong>[${m.nick}]</strong> ${m.text}</div>`;
  chatMessages.scrollTop=chatMessages.scrollHeight;
});

/* RADIO */
const radio=[
 {n:"Radio 80",u:"https://sphera.fluidstream.eu/radio80.aac"},
 {n:"SomaFM Underground 80s",u:"https://somafm.com/u80s130.pls"},
 {n:"80s80s Italo Disco",u:"https://streams.80s80s.de/italodisco/mp3-192"},
 {n:"Italia 80",u:"https://stream.laut.fm/italia80"}
];

const audio=document.getElementById("audio");
const now=document.getElementById("now");

/* CATEGORIE */
["Musica","Radio","Giochi","Chat"].forEach((c,i)=>{
 const d=document.createElement("div");
 d.className="category";
 d.textContent=c;
 d.onclick=()=>open(i,d);
 categories.appendChild(d);
});

function open(i,el){
 document.querySelectorAll(".category").forEach(x=>x.classList.remove("active"));
 el.classList.add("active");

 if(i===0)
  content.innerHTML=`<div class="grid">
   <a class="card" href="https://www.youtube.com/results?search_query=anni+80" target="_blank">üéµ YouTube</a>
   <a class="card" href="https://open.spotify.com/search/anni%2080" target="_blank">üéß Spotify</a>
  </div>`;

 if(i===1)
  content.innerHTML=`<div class="grid">${
   radio.map(r=>`<div class="card" onclick="play('${r.u}','${r.n}')">${r.n}</div>`).join("")
  }</div>`;

 if(i===2)
  content.innerHTML=`<div class="grid">
   <a class="card" href="https://archive.org/details/internetarcade" target="_blank">üïπÔ∏è Arcade</a>
   <a class="card" href="https://www.retrogames.cc/" target="_blank">üéÆ Retro</a>
  </div>`;

 if(i===3)
  content.innerHTML=`üí¨ Premi il pulsante chat per entrare`;
}

/* PLAY RADIO */
window.play=(u,n)=>{
 audio.src=u;
 audio.play();
 now.textContent="In riproduzione: "+n;
 startVU();
};

/* ===== VU METER ===== */
const vu=document.getElementById("vumeter");
const bars=[];
const TOTAL=24;
let vuTimer=null;

for(let i=0;i<TOTAL;i++){
 const b=document.createElement("div");
 b.className="vu"+(i>15?" red":i>10?" yellow":"");
 vu.appendChild(b);
 bars.push(b);
}

function startVU(){
 stopVU();
 vuTimer=setInterval(()=>{
  let peak=Math.random()*0.9+0.1;
  bars.forEach((b,i)=>{
   const center=Math.abs(i-(TOTAL/2));
   const power=Math.max(0,peak-center/12);
   b.style.height=(power*100)+"%";
  });
 },80);
}

function stopVU(){
 clearInterval(vuTimer);
 bars.forEach(b=>b.style.height="10%");
}

audio.addEventListener("play",startVU);
audio.addEventListener("pause",stopVU);
audio.addEventListener("ended",stopVU);
</script>

</body>
</html>
